<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini 2.0 Live Translator</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #1a73e8; text-align: center; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap; }
        select, input, button { padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 16px; }
        button { cursor: pointer; transition: 0.2s; }
        #recordBtn { background-color: #ea4335; color: white; border: none; }
        #recordBtn.recording { animation: pulse 1.5s infinite; background-color: #d93025; }
        #translateBtn { background-color: #1a73e8; color: white; border: none; }
        .translation-box { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        textarea { width: 100%; height: 100px; padding: 10px; border-radius: 6px; border: 1px solid #ccc; resize: none; font-size: 18px; }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .api-warning { font-size: 12px; color: #666; text-align: center; margin-bottom: 10px; }
    </style>
    
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
</head>
<body>

<div class="container">
    <h1>Gemini 2.0 Translator</h1>
    
    <div class="api-warning">
         驻转 API (驻转 砖专 驻驻   砖 砖专转 爪)
    </div>
    <div style="text-align:center; margin-bottom: 20px;">
        <input type="password" id="apiKey" placeholder="拽  转 -API Key 砖">
    </div>

    <div class="controls">
        <select id="sourceLang">
            <option value="he-IL">注专转 (专)</option>
            <option value="en-US">转 (专)</option>
        </select>
        <span>〃 ―</span>
        <select id="targetLang">
            <option value="English">转 (注)</option>
            <option value="Spanish">住驻专转 (注)</option>
            <option value="French">爪专驻转转 (注)</option>
            <option value="Hebrew">注专转 (注)</option>
            <option value="Japanese">驻转 (注)</option>
        </select>
    </div>

    <div class="controls">
        <button id="recordBtn"> 专 注砖</button>
        <button id="translateBtn">转专 拽住</button>
    </div>

    <div class="translation-box">
        <textarea id="inputText" placeholder="拽住 转专 驻注 ..."></textarea>
        <textarea id="outputText" placeholder="转专 驻注 ..." readonly style="background-color: #f9f9f9;"></textarea>
        <button id="speakBtn" style="background-color: #34a853; color: white; border:none;"> 砖注 转专</button>
    </div>
    
    <div id="status" style="text-align:center; margin-top:10px; color:#666;"></div>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    const recordBtn = document.getElementById('recordBtn');
    const translateBtn = document.getElementById('translateBtn');
    const speakBtn = document.getElementById('speakBtn');
    const inputText = document.getElementById('inputText');
    const outputText = document.getElementById('outputText');
    const statusDiv = document.getElementById('status');

    // 1. 专转  专 (Speech to Text)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        
        recordBtn.onclick = () => {
            recognition.lang = document.getElementById('sourceLang').value;
            recognition.start();
            recordBtn.classList.add('recording');
            statusDiv.textContent = "拽砖...";
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            inputText.value = transcript;
            recordBtn.classList.remove('recording');
            statusDiv.textContent = "专 拽. 转专...";
            // 转专  专 专
            performTranslation(); 
        };

        recognition.onerror = (event) => {
            recordBtn.classList.remove('recording');
            statusDiv.textContent = "砖  专: " + event.error;
        };
        
        recognition.onend = () => {
             recordBtn.classList.remove('recording');
        };
    } else {
        alert("驻驻 砖  转  专. 住 砖转砖 -Chrome.");
    }

    // 2. 驻拽爪转 转专 注 Gemini 2.0
    translateBtn.onclick = performTranslation;

    async function performTranslation() {
        const key = document.getElementById('apiKey').value;
        if (!key) { alert("  驻转 API"); return; }
        if (!inputText.value) { alert(" 拽住 转专"); return; }

        statusDiv.textContent = "转拽砖专 注 Gemini 2.0...";
        
        try {
            const genAI = new GoogleGenerativeAI(key);
            // 砖砖  Flash 专
            const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash-exp" });

            const targetLanguage = document.getElementById('targetLang').value;
            const prompt = `Translate the following text to ${targetLanguage}. Output ONLY the translated text without explanations: "${inputText.value}"`;

            const result = await model.generateContent(prompt);
            const response = await result.response;
            const text = response.text();

            outputText.value = text;
            statusDiv.textContent = "转专 砖.";
            
            // 拽专 转 砖 转爪
            speakText(text);

        } catch (error) {
            console.error(error);
            statusDiv.textContent = "砖: " + error.message;
        }
    }

    // 3. 专转 拽专转 拽住 (Text to Speech)
    speakBtn.onclick = () => speakText(outputText.value);

    function speakText(text) {
        if (!text) return;
        window.speechSynthesis.cancel(); // 注爪专转 专 拽

        const utterance = new SpeechSynthesisUtterance(text);
        
        // 住 转 转 拽 砖驻 拽专 (驻 住住)
        const targetLangName = document.getElementById('targetLang').value;
        let langCode = 'en-US';
        if (targetLangName === 'Spanish') langCode = 'es-ES';
        if (targetLangName === 'French') langCode = 'fr-FR';
        if (targetLangName === 'Hebrew') langCode = 'he-IL';
        if (targetLangName === 'Japanese') langCode = 'ja-JP';

        utterance.lang = langCode;
        window.speechSynthesis.speak(utterance);
    }
</script>

</body>
</html>
